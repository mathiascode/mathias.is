RewriteBase /
RewriteEngine On

AddDefaultCharset utf-8
AddCharset UTF-8 .br .css .gz .js .webmanifest
FileETag MTime Size
Options +ExecCGI
ServerSignature Off
SetEnvIf Host ^ suppress-error-charset

AddType image/x-icon .ico
AddType application/manifest+json .webmanifest

RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

ErrorDocument 404 /404.html
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule . - [R=404]

<FilesMatch "(contact|report)$">
SetHandler cgi-script
</FilesMatch>

<FilesMatch ".(htm|html)$">
Header set Content-Security-Policy "default-src 'none'; font-src data:; form-action 'self'; img-src 'self'; manifest-src 'self'; style-src 'self'; upgrade-insecure-requests; report-uri /report"
Header set X-Frame-Options "DENY"
Header set X-Xss-Protection "1; mode=block"
</FilesMatch>

Header set Referrer-Policy "no-referrer"
Header set Strict-Transport-Security "max-age=63072000; includeSubdomains; preload"
Header set Vary "Accept-Encoding"
Header set X-Content-Type-Options "nosniff"
Header unset Accept-Ranges
Header unset Last-Modified

RewriteCond %{HTTP:Accept-Encoding} br
RewriteCond %{REQUEST_FILENAME}.br -f
RewriteRule ^(.*)$ $1.br [L]

RewriteCond %{HTTP:Accept-Encoding} gzip
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)$ $1.gz [L]

AddEncoding br .br
AddEncoding gzip .gz

<FilesMatch (.css.br|.css.gz)>
ForceType text/css
</FilesMatch>

<FilesMatch (.ico.br|.ico.gz)>
ForceType image/x-icon
</FilesMatch>

<FilesMatch (.html.br|.html.gz)>
ForceType text/html
</FilesMatch>

<FilesMatch (.js.br|.js.gz)>
ForceType text/javascript
</FilesMatch>

<FilesMatch (.png.br|.png.gz)>
ForceType image/png
</FilesMatch>

<FilesMatch (.svg.br|.svg.gz)>
ForceType image/svg+xml
</FilesMatch>

<FilesMatch (.txt.br|.txt.gz)>
ForceType text/plain
</FilesMatch>

<FilesMatch (.webmanifest.br|.webmanifest.gz)>
ForceType application/manifest+json
</FilesMatch>

<FilesMatch (.xml.br|.xml.gz)>
ForceType text/xml
</FilesMatch>
